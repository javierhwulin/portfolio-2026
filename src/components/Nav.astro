---
const navLinks = [
  { name: "Home", href: "#hero-header" },
  { name: "About", href: "#about" },
  { name: "Projects", href: "#projects" },
  { name: "Skills", href: "#skills" },
  { name: "Contact", href: "#contact" },
];
---

<nav class="fixed top-4 left-1/2 -translate-x-1/2 z-20 w-[min(92%,1200px)]">
  <div
    class="glass h-14 w-full rounded-full flex items-center justify-between px-5"
    role="navigation"
    aria-label="Main navigation"
  >
    <a
      href="#hero-header"
      class="group inline-flex items-center gap-3 focus:outline-none"
    >
      <span
        class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/20 bg-white/5 text-[#ffe9b1] font-semibold shadow-sm group-hover:border-[#ffe9b1]/50 transition-colors"
      >
        JH
      </span>
      <span class="text-white/90 group-hover:text-white transition-colors hidden sm:inline">
        Javier Hengda
      </span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-2">
      <a
        href="#hero-header"
        data-navlink
        class="nav-link px-4 py-2 rounded-full text-white/80 hover:text-[#ffe9b1] hover:bg-white/5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#ffe9b1]/40 transition-colors active-nav"
      >
        Home
      </a>
      {
        navLinks.slice(1).map((link) => (
          <a
            href={link.href}
            data-navlink
            class="nav-link px-4 py-2 rounded-full text-white/80 hover:text-[#ffe9b1] hover:bg-white/5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#ffe9b1]/40 transition-colors"
          >
            {link.name}
          </a>
        ))
      }
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-toggle"
      class="md:hidden flex items-center justify-center w-10 h-10 rounded-full hover:bg-white/5 transition-colors"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <svg
        class="menu-icon"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="3" y1="6" x2="21" y2="6" class="line-1"></line>
        <line x1="3" y1="12" x2="21" y2="12" class="line-2"></line>
        <line x1="3" y1="18" x2="21" y2="18" class="line-3"></line>
      </svg>
    </button>
  </div>

  <!-- Mobile Menu Dropdown -->
  <div
    id="mobile-menu"
    class="mobile-menu-closed md:hidden absolute top-full left-0 right-0 mt-2 glass rounded-2xl overflow-hidden"
  >
    <div class="p-4 flex flex-col gap-1">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            data-navlink
            class="mobile-nav-link px-4 py-3 rounded-xl text-white/80 hover:text-[#ffe9b1] hover:bg-white/5 transition-colors"
          >
            {link.name}
          </a>
        ))
      }
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  let isMenuOpen = false;

  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    mobileMenuToggle?.setAttribute("aria-expanded", String(isMenuOpen));
    mobileMenu?.classList.toggle("mobile-menu-open", isMenuOpen);
    mobileMenu?.classList.toggle("mobile-menu-closed", !isMenuOpen);
  }

  mobileMenuToggle?.addEventListener("click", toggleMenu);

  // Close menu when clicking a link
  document.querySelectorAll("#mobile-menu a").forEach((link) => {
    link.addEventListener("click", () => {
      if (isMenuOpen) toggleMenu();
    });
  });

  // Active nav link observer
  const links = Array.from(document.querySelectorAll("a[data-navlink]"));
  
  // Group links by their href (to handle both desktop and mobile nav)
  const linksByHref = new Map<string, Element[]>();
  links.forEach((el) => {
    const href = (el.getAttribute("href") || "").replace("#", "");
    if (!linksByHref.has(href)) {
      linksByHref.set(href, []);
    }
    linksByHref.get(href)?.push(el);
  });

  const ids = ["hero-header", "about", "projects", "skills", "contact"];
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const id = entry.target.getAttribute("id");
        const matchingLinks = id ? linksByHref.get(id) : undefined;
        if (!matchingLinks) return;
        if (entry.isIntersecting) {
          // Remove active from all links
          links.forEach((a) => a.classList.remove("active-nav"));
          // Add active to all links with matching href
          matchingLinks.forEach((link) => link.classList.add("active-nav"));
        }
      });
    },
    { rootMargin: "-40% 0px -55% 0px", threshold: [0, 0.25, 0.5, 1] }
  );

  ids.forEach((id) => {
    const el = document.getElementById(id);
    if (el) observer.observe(el);
  });
</script>

<style>
  .nav-link {
    font-weight: 500;
  }

  .active-nav {
    color: var(--color-accent) !important;
    background: rgba(255, 255, 255, 0.1) !important;
    font-weight: 500;
    border-radius: 9999px;
  }

  .mobile-menu-closed {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .mobile-menu-open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .menu-icon {
    color: rgba(255, 255, 255, 0.8);
  }

  .mobile-nav-link {
    font-size: 1rem;
  }
</style>
