---
import Planet from "./Planet.vue";

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
---

<header
  id="hero-header"
  class="sticky top-0 w-full min-h-screen overflow-hidden will-change-opacity"
>
  <!-- Planet: Below text on mobile, right side on desktop -->
  <div
    class="absolute bottom-0 left-0 w-full h-[50vh] md:top-0 md:bottom-auto md:left-auto md:right-0 md:w-[120vw] md:h-full md:translate-x-[33%]"
  >
    <Planet client:load backgroundColor="#100c08" fitPadding={0.75} />
  </div>

  <!-- Overlapping Text Content -->
  <div class="relative z-10 min-h-screen flex items-center py-16 md:py-0">
    <div class="mx-auto max-w-7xl px-6 md:px-12 w-full">
      <div class="max-w-4xl">
        <div
          class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-white/80 shadow-sm"
        >
          <span class="h-2 w-2 rounded-full bg-[#ffe9b1]"></span>
          Available for new opportunities
        </div>
        <h1
          class="mt-6 text-5xl font-extrabold leading-[1.05] text-white md:text-7xl lg:text-8xl tracking-tight drop-shadow-2xl animate-slide-in-right animate-delay-100 animate-duration-slow"
        >
          {title}
        </h1>
        <p
          id="typewriter"
          class="mt-6 max-w-2xl text-lg text-[#ffe9b1]/95 md:text-2xl leading-relaxed drop-shadow-lg min-h-[2.5rem] md:min-h-[3rem]"
          data-text={description}
        >
        </p>

        <div class="mt-10 flex flex-col sm:flex-row gap-4">
          <a
            href="https://drive.google.com/file/d/1oARI6nplKD2Ila6GV_iflZnMkojIZ4o2/view?usp=sharing"
            target="_blank"
            class="inline-flex items-center justify-center rounded-full bg-[#B87333] text-[#100c08] px-6 py-3 font-semibold shadow hover:shadow-lg transition-shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#ffe9b1]/50"
          >
            Download Resume
          </a>
          <a
            href="#contact"
            class="inline-flex items-center justify-center rounded-full border border-white/20 bg-white/5 text-white px-6 py-3 font-semibold hover:bg-white/10 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/40"
          >
            Get in touch
          </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer Section -->
  <div class="absolute bottom-0 left-0 right-0 z-10 pb-8 md:pb-12">
    <div class="mx-auto max-w-7xl px-6 md:px-12">
      <!-- Divider Line -->
      <div class="w-full h-[1px] bg-white/30 mb-6"></div>

      <!-- Footer Text -->
      <p class="max-w-2xl text-sm md:text-base text-white/90 leading-relaxed">
        Open to job opportunities worldwide. Passionate about building polished,
        intuitive, and thoughtful digital experiences that leave a mark.
      </p>
    </div>
  </div>
</header>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const typewriterElement = document.getElementById("typewriter");
    if (!typewriterElement) return;
    const el = typewriterElement as HTMLElement;

    const phrases = [
      "Software Engineer",
      "Backend Developer",
      "Devops Specialist",
    ];
    let phraseIndex = 0;
    let charIndex = 0;
    let isTyping = true;

    // Clear and setup cursor
    el.textContent = "";
    el.style.position = "relative";
    const cursor = document.createElement("span");
    cursor.className = "typewriter-cursor";
    cursor.textContent = "|";
    el.appendChild(cursor);

    const typingSpeed = 30; // ms per character when typing
    const erasingSpeed = 20; // ms per character when erasing
    const startDelay = 500; // initial delay
    const pauseAfterType = 1400; // pause when fully typed
    const pauseAfterErase = 500; // pause when erased

    function currentFullText() {
      return phrases[phraseIndex];
    }

    function renderCurrent() {
      el.textContent = currentFullText().slice(0, charIndex);
      el.appendChild(cursor);
    }

    function loop() {
      const target = currentFullText();
      if (isTyping) {
        if (charIndex < target.length) {
          charIndex++;
          renderCurrent();
          setTimeout(loop, typingSpeed);
        } else {
          // Finished typing, pause then erase
          setTimeout(() => {
            isTyping = false;
            setTimeout(loop, erasingSpeed);
          }, pauseAfterType);
        }
      } else {
        if (charIndex > 0) {
          charIndex--;
          renderCurrent();
          setTimeout(loop, erasingSpeed);
        } else {
          // Finished erasing, move to next phrase and type again
          phraseIndex = (phraseIndex + 1) % phrases.length;
          setTimeout(() => {
            isTyping = true;
            setTimeout(loop, typingSpeed);
          }, pauseAfterErase);
        }
      }
    }

    setTimeout(loop, startDelay);
  });

  // Fade out header on scroll with smooth easing
  let ticking = false;

  function updateHeaderOpacity() {
    const header = document.getElementById("hero-header");
    if (!header) {
      return;
    }

    const scrollPosition = window.scrollY;
    const windowHeight = window.innerHeight;

    // Start fading after scrolling
    const fadeStart = 0;
    // Complete fade at 100% of viewport
    const fadeEnd = windowHeight * 0.75;

    if (scrollPosition <= fadeStart) {
      header.style.opacity = "1";
      header.style.pointerEvents = "auto";
    } else if (scrollPosition >= fadeEnd) {
      header.style.opacity = "0";
      header.style.pointerEvents = "none";
    } else {
      // Smooth fade with easeInOutCubic easing
      const progress = (scrollPosition - fadeStart) / (fadeEnd - fadeStart);
      const eased =
        progress < 0.5
          ? 4 * progress * progress * progress
          : 1 - Math.pow(-2 * progress + 2, 3) / 2;
      header.style.opacity = String(1 - eased);
    }

    ticking = false;
  }

  window.addEventListener("scroll", () => {
    if (!ticking) {
      window.requestAnimationFrame(updateHeaderOpacity);
      ticking = true;
    }
  });
</script>

<style>
  .typewriter-cursor {
    display: inline-block;
    margin-left: 2px;
    animation: blink 1s step-end infinite;
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }
</style>
